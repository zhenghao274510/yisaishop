(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/finishOrder"],{"07ce":function(t,e,i){"use strict";var n=i("c3ac"),o=i.n(n);o.a},7865:function(t,e,i){"use strict";i.r(e);var n=i("e9e9"),o=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=o.a},ac0a:function(t,e,i){"use strict";(function(t){i("b4b3");n(i("66fd"));var e=n(i("c37a"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},c37a:function(t,e,i){"use strict";i.r(e);var n=i("de58"),o=i("7865");for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);i("07ce");var c,s=i("f0c5"),a=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);e["default"]=a.exports},c3ac:function(t,e,i){},de58:function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n}));var n={uniSteps:function(){return i.e("components/uni-steps/uni-steps").then(i.bind(null,"6537"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,t.__map(t.allCartList,(function(e,i){var n=t.__get_orig(e),o=t.__map(e.dataList,(function(e,i){var n=t.__get_orig(e),o=t._f("parsePrice")(e.price);return{$orig:n,f0:o}}));return{$orig:n,l0:o}}))),n=""==t.compline.id||t.showNoCompline?null:t._f("parsePrice")(1==t.compline.use_type?t.compline.amount:t.compline.money),o=t._f("parsePrice")(t.goodsoldPrice),r=0!=t.differencePrice?t._f("parsePrice")(t.differencePrice):null,c=0!=t.freight?t._f("parsePrice")(t.freight):null,s=0!=t.totalPrice?t._f("parsePrice")(t.totalPrice):null,a=2==t.send_type&&0!=t.livePrice?t._f("parsePrice")(t.shopInfo.startmoney):null,u=2==t.send_type&&0!=t.livePrice?t._f("parsePrice")(t.livePrice):null,d=0!=t.totalPrice?t._f("parsePrice")(t.totalPrice):null;t.$mp.data=Object.assign({},{$root:{l1:i,f1:n,f2:o,f3:r,f4:c,f5:s,f6:a,f7:u,f8:d}})},r=[]},e9e9:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){i.e("components/uni-steps/uni-steps").then(function(){return resolve(i("6537"))}.bind(null,i)).catch(i.oe)},o=function(){i.e("components/mycom/homePoup").then(function(){return resolve(i("ae97"))}.bind(null,i)).catch(i.oe)},r={components:{uniSteps:n,homePounp:o},data:function(){return{showz_p:!1,title:"",send_type:2,goodsoldPrice:0,goodsPrice:0,differencePrice:0,distance:0,showNoCompline:!1,isActive:0,addressData:{id:"",phone:"",name:"",address:"",sex:"",lon:"",lat:"",isdefault:"",province_city_town:""},shopInfo:{startmoney:"",merchanttype:1,bydistance:"",by_money:"",man_money:"",yuan:"",fp_money:"",p_money:""},dataList:[],allCartList:[],compline:{},freight:0,type:"",remarks:"",groupId:""}},computed:{shop:function(){return t.getStorageSync("shop")},livePrice:function(){var t=0;return 0!=this.goodsPrice&&(t=Number(this.shopInfo.startmoney)-Number(this.goodsPrice)),t<0&&(t=0),t},totalPrice:function(){var t=0;return 0!=this.goodsPrice&&(t+=Number(this.goodsPrice)),0!=this.freight&&(t+=Number(this.freight)),this.compline.id&&(1==this.compline.use_type?t-=Number(this.compline.amount):t-=Number(this.compline.money)),t}},onLoad:function(t){this.dataList=JSON.parse(decodeURIComponent(t.goods)),this.type=t.type,this.getUserBuyType(),this.filterItem()},onHide:function(){this.groupId=""},watch:{dataList:{handler:function(t){var e=0;t.forEach((function(t){e+=100*t.price*t.qty})),this.goodsoldPrice=e/100},deep:!0},allCartList:{handler:function(t){var e=0;t.forEach((function(t){e+=Number(t.totalPrice)})),this.goodsPrice=e},deep:!0},addressData:{handler:function(t){3!=this.send_type&&this.getdistance()},deep:!0},goodsPrice:function(t){this.getUserCompline(),this.differencePrice=this.goodsoldPrice-t}},methods:{filterItem:function(){var t=this,e={},i=[];this.dataList.forEach((function(t,n){if(e[t.categoryId])i.forEach((function(e,i){e[0].categoryId==t.categoryId&&e.push(t)}));else{var o=[];o.push(t),i.push(o),e[t.categoryId]=t}})),i.forEach((function(e){console.log(e),e.dataList=e,e.goodsPrice=0,e.totalPrice=0,e.childTotalPrice=0,e.forEach((function(i){i.goodsprice=i.price*i.qty;var n=t.getgoodsPrice(i.goodsprice,i.merchantReductionList);n?(i.totalPrice=n.price,i.acountPrice=n.acountPrice,i.mz_title=n.mz_title):(i.totalPrice=i.goodsprice,i.acountPrice=0,i.mz_title=""),e.goodsPrice+=i.price*i.qty,e.childTotalPrice+=Number(i.totalPrice)}));var i=t.getClassPrice(e.goodsPrice,e);i?(e.totalPrice=i.price,e.acountPrice=i.acountPrice,e.mz_title=i.mz_title):(e.totalPrice=e.goodsPrice,e.acountPrice=0,e.mz_title=""),e.childTotalPrice<e.totalPrice&&(e.totalPrice=e.childTotalPrice)})),this.allCartList=i},getUserBuyType:function(){if(2==t.getStorageSync("open"))return this.send_type=3,this.getDefault(),void this.getFirget();t.getStorageSync("defaultValue")&&(0==t.getStorageSync("defaultValue")?this.send_type=1:this.send_type=2),1!=this.send_type&&(this.getDefault(),this.getFirget())},getgoodsPrice:function(t,e){var i=this;if(0==e.length)return!1;var n=[];e.forEach((function(e){var o={price:100*t,acountPrice:0,mz_title:""};o=i.filterPrice(o,e),n.push({price:o.price/100,acountPrice:o.acountPrice,mz_title:o.mz_title})}));var o=n.sort((function(t,e){return t.price-e.price}));return o[0]},filterPrice:function(t,e){if(2==e.type&&t.price>=100*e.mj_price&&(t.price-=100*e.mj_amount,t.acountPrice="满".concat(e.mj_price,"元减").concat(e.mj_amount,"元")),3==e.type&&obj.qty>=e.dz_number){var i=Math.floor(obj.qty/e.dz_number);t.price=100*Number(obj.price)*(obj.qty-i)+Number(i*(100*obj.price)*e.jz_amount/10),t.acountPrice="第".concat(e.dz_number,"件").concat(e.jz_amount,"折")}if(4==e.type&&t.price>=100*e.mz_price&&(this.title=e.zp_title,this.showz_p=!0,t.mz_title="满".concat(e.mz_price,"元增").concat(e.zp_title)),5==e.type&&t.price>=100*e.mm_price){var n=Math.floor(t.price/(100*e.mm_price));t.price-=n*e.mm_amount*100,t.acountPrice="每满".concat(e.mm_price,"元减").concat(e.mm_amount,"元")}return t},getClassPrice:function(t,e){var i=this,n=[],o=e.dataList[0].merchantReductionList;if(0==o.lenght)return!1;o.forEach((function(e){var o={price:100*t,acountPrice:0,mz_title:""};2==e.use_type&&(o=i.filterPrice(o,e)),n.push({price:o.price/100,acountPrice:o.acountPrice,mz_title:o.mz_title})}));var r=n.sort((function(t,e){return t.price-e.price}));return r[0]},fromFright:function(){var t=this.shopInfo.merchanttype;1!=t&&4!=t||(this.distance<=1e3*this.shopInfo.bydistance?this.freight=0:this.freight=(this.distance-1e3*this.shopInfo.bydistance)*(100*this.shopInfo.by_money)/100/1e3)},userConfirm:function(){var t=this;this.throttle((function(){t.getOrderId()}))},getdistance:function(){var e=this,i={cmd:"getDitance",id:this.addressData.id,merchantId:t.getStorageSync("merchantId")};this._reqw.post(i).then((function(t){0==t.result?(e.distance=t.body.distance,e.fromFright()):e.$api.tip(t.resultNote)})).catch((function(t){}))},getFirget:function(){var e=this,i={cmd:"getSendRate",merchantId:t.getStorageSync("merchantId"),province:t.getStorageSync("province")};this._reqw.post(i).then((function(t){0==t.result?e.shopInfo=t.body:e.$api.tip(t.resultNote)})).catch((function(t){}))},submit:function(){1!=this.send_type?""==this.addressData.id?this.$api.tip("请选择收货地址!"):this.getOrderId():this.$refs.homePounp.open()},getUserCompline:function(){var e=this,i={cmd:"getMemberCouponList",uid:t.getStorageSync("uid"),merchant_id:t.getStorageSync("merchantId")};"cart"!=this.type&&(i.product_id=this.dataList[0].product_id),this._reqw.post(i).then((function(t){0==t.result?e.fromCompline(t.body):e.$api.tip(t.resultNote)})).catch((function(t){}))},fromCompline:function(t){var e=this,i=[];if(0!=t.dataList.length)if(t.dataList.forEach((function(t){1==t.use_type&&Number(e.goodsPrice)>=Number(t.price)&&i.push(t),2==t.use_type&&Number(e.goodsPrice)>Number(t.money)&&(t.amount=t.money,i.push(t))})),0!=i.length){var n=i.sort((function(t,e){return e.amount-t.amount}));0!=n.length&&(this.compline=n[0])}else this.showNoCompline=!0;else this.showNoCompline=!0},getCompline:function(){var t="";t="cart"==this.type?"/pages/mineoptions/canUserCompline?money=".concat(this.goodsPrice,"&type=").concat(this.type):"/pages/mineoptions/canUserCompline?money=".concat(this.goodsPrice,"&type=").concat(this.type,"&id=").concat(this.dataList[0].product_id),this.$api.navTo(t)},getDefault:function(){var e=this,i={cmd:"getDefaultAddress",uid:t.getStorageSync("uid")};this._reqw.post(i).then((function(t){console.log(t),0==t.result?""!=t.body.id&&(e.addressData=t.body):e.$api.tip(t.resultNote)})).catch((function(t){}))},choseAddress:function(){2!=this.send_type&&this.$api.navTo("/pages/mineoptions/myAddress?source=1")},getOrderId:function(){var e=this,i=(this.type,[]);this.dataList.forEach((function(t){i.push(t.id)}));var n={uid:t.getStorageSync("uid"),message:this.remarks,merchant_id:t.getStorageSync("merchantId"),ordersMoney:this.totalPrice,sendMoney:this.freight,send_type:this.send_type,merchant_reduction_money:this.differencePrice,cmd:"saveCartOrder",cartList:i};2!=this.send_type||0==this.livePrice?(2==this.compline.coupon_type?(n.member_point_coupon_id=this.compline.id,n.member_coupon_money=this.compline.amount):(n.member_coupon_id=this.compline.id,n.member_coupon_money=this.compline.amount),1!=this.send_type&&(n.addressId=this.addressData.id),this._reqw.post(n).then((function(t){0==t.result?4==e.type&&0==e.totalPrice?(e.$api.tip("兑换成功!"),e.$api.redirectTo("/pages/order/index")):e.$api.redirectTo("/pages/order/payOrder?id=".concat(t.body.id,"&money=").concat(t.body.orderMoney,"&type=finish")):e.$api.tip(t.resultNote)})).catch((function(t){}))):this.$api.tip("还差".concat(this.livePrice,"元起送,在逛逛吧!"))}}};e.default=r}).call(this,i("543d")["default"])}},[["ac0a","common/runtime","common/vendor"]]]);