(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/creatOrder"],{1689:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o(i("a34a"));function o(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i,n,o,r,c){try{var s=t[r](c),a=s.value}catch(d){return void i(d)}s.done?e(a):Promise.resolve(a).then(n,o)}function c(t){return function(){var e=this,i=arguments;return new Promise((function(n,o){var c=t.apply(e,i);function s(t){r(c,n,o,s,a,"next",t)}function a(t){r(c,n,o,s,a,"throw",t)}s(void 0)}))}}var s=function(){i.e("components/uni-steps/uni-steps").then(function(){return resolve(i("6537"))}.bind(null,i)).catch(i.oe)},a=function(){i.e("components/mycom/homePoup").then(function(){return resolve(i("ae97"))}.bind(null,i)).catch(i.oe)},d={components:{uniSteps:s,homePounp:a},data:function(){return{showz_p:!1,title:"",send_type:2,goodsoldPrice:0,goodsPrice:0,differencePrice:0,distance:0,showNoCompline:!1,isActive:0,addressData:{id:"",phone:"",name:"",address:"",sex:"",lon:"",lat:"",isdefault:"",province_city_town:""},shopInfo:{startmoney:"",merchanttype:1,bydistance:"",by_money:"",man_money:"",yuan:"",fp_money:"",p_money:""},dataList:[],sameCommonList:[],compline:{id:"",price:"",amount:"",endDate:"",create_date:"",startDate:"",type:"",coupon_type:"",use_type:"",news:"",line_type:"",money:"",product_id:"",category_id:""},freight:0,type:"",remarks:"",groupId:""}},computed:{shop:function(){return t.getStorageSync("shop")},livePrice:function(){var t=0;return 0!=this.goodsPrice&&(t=Number(this.shopInfo.startmoney)-Number(this.goodsPrice)),t<0&&(t=0),t},totalPrice:function(){var t=0;return 0!=this.goodsPrice&&(t+=Number(this.goodsPrice)),0!=this.freight&&(t+=Number(this.freight)),""!=this.compline.id&&(1==this.compline.use_type?t-=Number(this.compline.amount):t-=Number(this.compline.money)),t}},onLoad:function(t){this.dataList=JSON.parse(decodeURIComponent(t.goods)),this.type=t.type,t.id&&(this.groupId=t.id),this.getUserBuyType()},onHide:function(){this.groupId=""},watch:{dataList:{handler:function(t){var e=0;this.dataList.forEach((function(t){e+=100*t.price*t.qty})),this.goodsoldPrice=e/100},deep:!0},addressData:{handler:function(t){3!=this.send_type&&4!=this.type&&this.getdistance()},deep:!0},type:function(t){4==t?this.goodsPrice=this.goodsoldPrice=0:5==t?this.fromgoodsPrice():"cart"==t?(this.goodsPrice=this.getgoodsPrice(this.dataList[0],this.dataList[0].merchantReductionList).price,this.dataList[0].acountPrice=this.getgoodsPrice(this.dataList[0],this.dataList[0].merchantReductionList).acountPrice):this.goodsPrice=this.goodsoldPrice},goodsPrice:function(t){5!=this.type&&"cart"!=this.type||(this.getUserCompline(),this.differencePrice=(100*this.goodsoldPrice-100*t)/100)}},methods:{getUserBuyType:function(){if(2==t.getStorageSync("open"))return this.send_type=3,this.getDefault(),void this.getFirget();t.getStorageSync("defaultValue")&&(0==t.getStorageSync("defaultValue")?this.send_type=1:this.send_type=2),1!=this.send_type&&(this.getDefault(),this.getFirget())},fromgoodsPrice:function(){var e=this;return c(n.default.mark((function i(){var o,r,c;return n.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return o=e.dataList[0].product_id,r={cmd:"getMerchantReductionList",id:o,type:e.type,merchantId:t.getStorageSync("merchantId")},i.next=4,e._reqw.post(r);case 4:if(c=i.sent,0==c.result){i.next=8;break}return e.$api.tip(c.resultNote),i.abrupt("return");case 8:e.goodsPrice=e.getgoodsPrice(e.dataList[0],c.body.merchantReductionList).price,e.dataList[0].acountPrice=e.getgoodsPrice(e.dataList[0],c.body.merchantReductionList).acountPrice;case 10:case"end":return i.stop()}}),i)})))()},getgoodsPrice:function(t,e){var i=this;if(0==e.length)return{price:Number(100*t.price)*Number(t.qty)/100,acountPrice:0};var n=[];e.forEach((function(e){var o={price:0,acountPrice:""};if(o.price=100*Number(t.price)*Number(t.qty),2==e.type&&o.price>=100*e.mj_price&&(o.price-=100*e.mj_amount,o.acountPrice="满".concat(e.mj_price,"元减").concat(e.mj_amount,"元")),3==e.type&&t.qty>=e.dz_number){var r=Math.floor(t.qty/e.dz_number);o.price=100*Number(t.price)*(t.qty-r)+Number(r*(100*t.price)*e.jz_amount/10),o.acountPrice="第".concat(e.dz_number,"件").concat(e.jz_amount,"折")}if(4==e.type&&o.price>=100*e.mz_price&&(i.title=e.zp_title,i.showz_p=!0,t.mz_title="满".concat(e.mz_price,"元增").concat(e.zp_title)),5==e.type&&o.price>=100*e.mm_price){var c=Math.floor(o.price/(100*e.mm_price));o.price-=c*e.mm_amount*100,o.acountPrice="每满".concat(e.mm_price,"元减").concat(e.mm_amount,"元")}n.push({price:o.price/100,acountPrice:o.acountPrice})}));var o=n.sort((function(t,e){return t.price-e.price}));return o[0]},fromFright:function(){var t=this.shopInfo.merchanttype;1!=t&&4!=t||(this.distance<=1e3*this.shopInfo.bydistance?this.freight=0:this.freight=(this.distance-1e3*this.shopInfo.bydistance)*(100*this.shopInfo.by_money)/100/1e3)},userConfirm:function(){var t=this;this.throttle((function(){t.getOrderId()}))},getdistance:function(){var e=this,i={cmd:"getDitance",id:this.addressData.id,merchantId:t.getStorageSync("merchantId")};this._reqw.post(i).then((function(t){0==t.result?(e.distance=t.body.distance,e.fromFright()):e.$api.tip(t.resultNote)})).catch((function(t){}))},getFirget:function(){var e=this,i={cmd:"getSendRate",merchantId:t.getStorageSync("merchantId"),province:t.getStorageSync("province")};this._reqw.post(i).then((function(t){0==t.result?e.shopInfo=t.body:e.$api.tip(t.resultNote)})).catch((function(t){}))},submit:function(){1!=this.send_type?""==this.addressData.id?this.$api.tip("请选择收货地址!"):this.getOrderId():this.$refs.homePounp.open()},getUserCompline:function(){var e=this,i={cmd:"getMemberCouponList",uid:t.getStorageSync("uid"),merchant_id:t.getStorageSync("merchantId")};this.dataList[0].endTime||(i.product_id=this.dataList[0].product_id,this._reqw.post(i).then((function(t){0==t.result?e.fromCompline(t.body):e.$api.tip(t.resultNote)})).catch((function(t){})))},fromCompline:function(t){var e=this,i=[];if(0!=t.dataList.length)if(t.dataList.forEach((function(t){1==t.use_type&&Number(e.goodsPrice)>=Number(t.price)&&i.push(t),2==t.use_type&&Number(e.goodsPrice)>Number(t.money)&&(t.amount=t.money,i.push(t))})),0!=i.length){var n=i.sort((function(t,e){return e.amount-t.amount}));0!=n.length&&(this.compline=n[0])}else this.showNoCompline=!0;else this.showNoCompline=!0},getCompline:function(){var t="";t="cart"==this.type?"/pages/mineoptions/canUserCompline?money=".concat(this.goodsPrice,"&type=").concat(this.type):"/pages/mineoptions/canUserCompline?money=".concat(this.goodsPrice,"&type=").concat(this.type,"&id=").concat(this.dataList[0].product_id),this.$api.navTo(t)},getDefault:function(){var e=this,i={cmd:"getDefaultAddress",uid:t.getStorageSync("uid")};this._reqw.post(i).then((function(t){console.log(t),0==t.result?""!=t.body.id&&(e.addressData=t.body):e.$api.tip(t.resultNote)})).catch((function(t){}))},choseAddress:function(){2!=this.send_type&&this.$api.navTo("/pages/mineoptions/myAddress?source=1")},getOrderId:function(){var e=this,i=0;i=6==this.type?1:7==this.type?6:this.type;var n={uid:t.getStorageSync("uid"),message:this.remarks,merchant_id:t.getStorageSync("merchantId"),ordersMoney:this.totalPrice,sendMoney:this.freight,send_type:this.send_type,merchant_reduction_money:this.differencePrice,number:this.dataList[0].qty,skuId:this.dataList[0].skuid,type:i,setId:this.dataList[0].setId||""};2!=this.send_type||0==this.livePrice?(2==this.compline.coupon_type?(n.member_point_coupon_id=this.compline.id,n.member_coupon_money=this.compline.amount):(n.member_coupon_id=this.compline.id,n.member_coupon_money=this.compline.amount),1!=this.send_type&&(n.addressId=this.addressData.id),1==this.type&&""!=this.groupId?(n.cmd="addGroupOrder",n.id=this.groupId):n.cmd="saveOrder",console.log(n),this._reqw.post(n).then((function(t){0==t.result?4==e.type&&0==e.totalPrice?(e.$api.tip("兑换成功!"),e.$api.redirectTo("/pages/order/index")):e.$api.redirectTo("/pages/order/payOrder?id=".concat(t.body.id,"&money=").concat(t.body.orderMoney,"&type=finish")):e.$api.tip(t.resultNote)})).catch((function(t){}))):this.$api.tip("还差".concat(this.livePrice,"元起送,在逛逛吧!"))}}};e.default=d}).call(this,i("543d")["default"])},"29fb":function(t,e,i){},"425a":function(t,e,i){"use strict";i.d(e,"b",(function(){return o})),i.d(e,"c",(function(){return r})),i.d(e,"a",(function(){return n}));var n={uniSteps:function(){return i.e("components/uni-steps/uni-steps").then(i.bind(null,"6537"))}},o=function(){var t=this,e=t.$createElement,i=(t._self._c,t.__map(t.dataList,(function(e,i){var n=t.__get_orig(e),o=4!=t.type?t._f("parsePrice")(e.price):null;return{$orig:n,f0:o}}))),n=5!=t.type&&"cart"!=t.type||""==t.compline.id||t.showNoCompline?null:t._f("parsePrice")(1==t.compline.use_type?t.compline.amount:t.compline.money),o=4!=t.type?t._f("parsePrice")(t.goodsoldPrice):null,r=0!=t.differencePrice?t._f("parsePrice")(t.differencePrice):null,c=0!=t.freight?t._f("parsePrice")(t.freight):null,s=0!=t.totalPrice?t._f("parsePrice")(t.totalPrice):null,a=4!=t.type&&2==t.send_type&&0!=t.livePrice?t._f("parsePrice")(t.shopInfo.startmoney):null,d=4!=t.type&&2==t.send_type&&0!=t.livePrice?t._f("parsePrice")(t.livePrice):null,u=0!=t.totalPrice?t._f("parsePrice")(t.totalPrice):null;t.$mp.data=Object.assign({},{$root:{l0:i,f1:n,f2:o,f3:r,f4:c,f5:s,f6:a,f7:d,f8:u}})},r=[]},"74a9":function(t,e,i){"use strict";(function(t){i("b4b3");n(i("66fd"));var e=n(i("f507"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},d124:function(t,e,i){"use strict";i.r(e);var n=i("1689"),o=i.n(n);for(var r in n)"default"!==r&&function(t){i.d(e,t,(function(){return n[t]}))}(r);e["default"]=o.a},eec0:function(t,e,i){"use strict";var n=i("29fb"),o=i.n(n);o.a},f507:function(t,e,i){"use strict";i.r(e);var n=i("425a"),o=i("d124");for(var r in o)"default"!==r&&function(t){i.d(e,t,(function(){return o[t]}))}(r);i("eec0");var c,s=i("f0c5"),a=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);e["default"]=a.exports}},[["74a9","common/runtime","common/vendor"]]]);